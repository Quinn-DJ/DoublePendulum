# 双摆模拟程序

这是一个使用Verlet算法实现的双摆（Double Pendulum）模拟程序，用C++编写并配有Python可视化功能。

## 功能特性

- **Verlet积分算法**：使用高精度的Verlet积分算法进行双摆系统的数值求解
- **可配置参数**：通过配置文件灵活设置初始条件和物理参数
- **数据输出**：C++程序输出时间序列数据到文本文件
- **Python可视化**：使用matplotlib生成高质量的PNG静态图像和GIF动画
- **自动环境管理**：自动创建和管理conda虚拟环境
- **混沌系统演示**：展示双摆系统的混沌行为特性

## 项目结构

```
DoublePendulum/
├── include/
│   └── DoublePendulum.hpp  # 双摆类头文件
├── src/
│   ├── DoublePendulum.cpp  # 双摆类实现
│   └── main.cpp            # 主程序入口
├── config/
│   └── config              # 配置文件
├── setup_env.sh            # conda环境设置脚本
├── visualize.py            # Python可视化脚本
└── Makefile                # 构建配置
```

## 快速开始

### 1. 环境设置
首次使用前，需要设置conda环境和Python依赖：
```bash
./setup_env.sh
```

### 2. 编译程序
```bash
make gcc
```

### 3. 运行模拟
```bash
# 运行C++程序生成数据
make run

# 生成静态轨迹图
make plot

# 生成动画（逐帧保存方式）
make animate

# 生成动画并保留帧文件
make animate-keep

# 一键生成数据和静态图
make all
```

## 配置文件

配置文件 `config/config` 采用键值对格式，定义了双摆系统的物理参数和模拟设置：

```
L1=1.0          # 第一个摆的长度 (m)
L2=1.0          # 第二个摆的长度 (m) 
M1=1.0          # 第一个摆球的质量 (kg)
M2=1.0          # 第二个摆球的质量 (kg)
G=9.8           # 重力加速度 (m/s²)
THETA1=0.0      # 第一个摆的初始角度 (弧度)
THETA2=0.0      # 第二个摆的初始角度 (弧度)
OMEGA1=3.0      # 第一个摆的初始角速度 (rad/s)
OMEGA2=0.0      # 第二个摆的初始角速度 (rad/s)
DT=0.00001      # 时间步长 (s)
TOTAL_TIME=10.0 # 总模拟时间 (s)
```

### 参数说明
- **物理参数**：L1, L2为摆长；M1, M2为摆球质量；G为重力加速度
- **初始条件**：THETA1, THETA2为初始角度；OMEGA1, OMEGA2为初始角速度
- **数值参数**：DT为时间步长（影响精度和速度）；TOTAL_TIME为模拟总时长

## 程序输出

### C++程序输出
C++程序读取配置文件，运行双摆模拟，并将结果输出到数据文件（默认为 `pendulum_data.txt`），格式如下：
```
# 配置信息：L1=1.00 L2=1.00 M1=1.00 M2=1.00
时间 x1坐标 y1坐标 x2坐标 y2坐标
0.000000 0.000000 -1.000000 0.000000 -2.000000
0.000010 0.000030 -0.999999 0.000060 -1.999998
...
```

### Python可视化输出
Python脚本可生成两种类型的可视化：

1. **静态轨迹图**（PNG格式）
   - 显示两个摆球的完整运动轨迹
   - 红色轨迹：第一个摆球
   - 蓝色轨迹：第二个摆球
   - 包含起始点、固定点和最终摆杆位置

2. **动画**（GIF格式）
   - 动态展示双摆的实时运动
   - 包含摆杆、摆球和轨迹尾迹
   - 可调节帧率和轨迹长度
   
3. **动画创建模式**
   - 使用逐帧模式创建高质量动画
   - 帧文件临时存储在 `output/` 目录中
   - 可选择保留帧文件用于检查或后处理
   - 文件命名格式: `frame_XXXXXX.png`
   - 更好的内存管理和性能控制

## 算法原理

### Verlet积分算法
程序使用Verlet算法求解双摆的运动方程，该算法具有以下优点：
- **时间对称性**：更好的数值稳定性
- **能量守恒**：长期积分中能量保持相对稳定
- **高精度**：二阶精度的数值积分方法

算法步骤：
1. **位置更新**：`θ(t+dt) = 2*θ(t) - θ(t-dt) + α(t)*dt²`
2. **速度更新**：`ω(t) = [θ(t+dt) - θ(t-dt)] / (2*dt)`

### 双摆系统动力学
双摆是一个具有两个自由度的非线性动力学系统，其拉格朗日方程推导出的运动方程包含：
- **重力作用**：两个摆球受到的重力影响
- **约束力**：摆杆的刚体约束
- **耦合效应**：两个摆球之间的相互作用

角加速度计算涉及复杂的三角函数和耦合项，体现了系统的非线性特性。

## 混沌行为特性

双摆系统是经典的混沌系统，具有以下特征：
- **初值敏感性**：微小的初始条件变化导致截然不同的长期行为
- **不可预测性**：长期行为无法精确预测
- **分形轨迹**：在相空间中形成复杂的分形结构
- **准周期运动**：在某些参数下表现出准周期或混沌运动

通过改变初始角度或角速度，可以观察到从规律摆动到完全混沌的过渡过程。

## 系统要求

### C++编译环境
- **编译器**：支持C++11标准的编译器（如GCC 4.8+）
- **构建工具**：GNU Make
- **操作系统**：Linux、macOS或Windows（使用WSL）

### Python环境
- **Python版本**：3.9或更高版本
- **包管理**：Conda（推荐Miniconda或Anaconda）
- **依赖包**：
  - `matplotlib`：用于图形绘制和动画生成
  - `numpy`：用于数值计算和数据处理
  - `PIL (Pillow)`：用于逐帧模式的图像处理和GIF生成

*注意：Python依赖会通过`setup_env.sh`脚本自动安装到本地conda环境中*

## 使用技巧

### 参数调优建议
1. **时间步长（DT）**：
   - 较小值（如0.00001）：精度高但计算慢
   - 较大值（如0.01）：计算快但可能不稳定
   - 推荐范围：0.0001 - 0.001

2. **初始条件实验**：
   - 小角度：近似为线性系统，规律摆动
   - 大角度：非线性效应明显，可能出现混沌
   - 不同初始速度：产生不同类型的运动模式

3. **模拟时间**：
   - 短时间（<5s）：观察基本运动模式
   - 长时间（10-30s）：观察混沌行为和轨迹复杂性

### 故障排除
- **编译失败**：确保安装了g++和make工具
- **Python环境问题**：重新运行`./setup_env.sh`
- **数据文件为空**：检查配置文件格式和参数有效性
- **动画生成失败**：确保有足够磁盘空间，GIF文件可能较大
- **逐帧模式问题**：检查PIL/Pillow是否已安装；可使用`make animate`作为替代方案
- **单独帧文件**：使用`--keep-frames`选项保留帧文件以便手动处理

## Make命令详解

| 命令 | 功能 | 说明 |
|------|------|------|
| `make gcc` | 编译C++程序 | 生成可执行文件`double_pendulum` |
| `make run` | 运行模拟 | 使用默认配置生成数据文件 |
| `make plot` | 静态图 | 根据数据文件生成PNG轨迹图 |
| `make animate` | 动画（传统模式） | 使用matplotlib生成GIF动画 |
| `make animate-frames` | 动画（逐帧模式） | 保存单独帧文件后生成GIF |
| `make animate-frames-keep` | 动画（保留帧） | 逐帧模式且保留所有帧文件 |
| `make all` | 完整流程 | 编译→运行→生成静态图 |
| `make clean` | 清理 | 删除所有生成文件和conda环境 |
| `make help` | 帮助 | 显示所有可用命令 |

## 示例运行结果

### 配置示例：小角度摆动
```bash
# 配置文件设置：THETA1=0.5, THETA2=0.3, OMEGA1=0, OMEGA2=0
# 结果：规律的椭圆形轨迹，表现为准周期运动
```

### 配置示例：大角度混沌
```bash
# 配置文件设置：THETA1=3.0, THETA2=2.0, OMEGA1=1, OMEGA2=1  
# 结果：复杂的分形轨迹，典型的混沌行为
```

## 项目扩展

可以考虑的功能扩展：
- 添加阻尼效应（空气阻力、摩擦力）
- 实现不同的数值积分算法对比
- 添加相空间图和庞加莱截面分析
- 支持更多初始条件的批量处理
- 添加能量守恒监控和分析

## 许可证

本项目遵循MIT许可证。

## 贡献

欢迎提交Issue和Pull Request来改进本项目！

---

**语言**: [English](README.md) | [中文](README_CN.md)
