# 双摆模拟程序

这是一个使用Verlet算法实现的双摆（Double Pendulum）模拟程序，用C++编写。

## 功能特性

- **Verlet算法**：使用高精度的Verlet积分算法进行数值求解
- **可配置参数**：通过配置文件设置初始条件和物理参数
- **轨迹可视化**：生成BMP格式的图像，显示两个摆球的运动轨迹
- **Python可视化**：使用matplotlib生成高质量的PNG图像和GIF动画
- **多配置支持**：支持多个不同的初始条件配置
- **自动环境管理**：自动创建和管理Python虚拟环境

## 文件结构

```
programme/DoublePendulum/
├── include/
│   ├── Bitmap.hpp          # BMP图像处理头文件
│   └── DoublePendulum.hpp  # 双摆类头文件
├── src/
│   ├── Bitmap.cpp          # BMP图像处理实现
│   ├── DoublePendulum.cpp  # 双摆类实现
│   └── main.cpp            # 主程序
├── config/
│   └── config              # 配置文件
├── setup_env.sh            # 环境设置脚本
├── visualize.py            # Python可视化脚本
├── requirements.txt        # Python依赖列表
└── Makefile                # 编译配置
```

## 编译与运行

### 环境设置
首次使用前，需要设置Python环境：
```bash
make setup
# 或者
./setup_env.sh
```

### 编译程序
```bash
make
```

### C++程序运行
```bash
# 使用默认配置（BMP输出）
make run

# 使用配置2
make run2

# 数据输出模式
make data
make data2
```

### Python可视化
```bash
# 生成数据并创建静态图
make full

# 生成数据并创建动画
make full-anim

# 仅生成静态图（需要先有数据文件）
make plot

# 仅生成动画（需要先有数据文件）
make animate
```

### 清理文件
```bash
make clean  # 清理所有生成的文件和Python环境
```

### 帮助信息
```bash
make help   # 显示所有可用的make命令
```

## 配置文件格式

配置文件采用键值对格式，支持注释（以#开头）：

```
# 物理参数
L1=1.0          # 第一个摆的长度(m)
L2=1.0          # 第二个摆的长度(m)
M1=1.0          # 第一个球的质量(kg)
M2=1.0          # 第二个球的质量(kg)
G=9.81          # 重力加速度(m/s²)

# 初始条件
THETA1=1.5      # 第一个摆的初始角度(弧度)
THETA2=1.0      # 第二个摆的初始角度(弧度)
OMEGA1=0.0      # 第一个摆的初始角速度(rad/s)
OMEGA2=0.0      # 第二个摆的初始角速度(rad/s)

# 模拟参数
DT=0.01         # 时间步长(s)
TOTAL_TIME=20.0 # 总模拟时间(s)
WIDTH=800       # 图像宽度(像素)
HEIGHT=800      # 图像高度(像素)
SCALE=200       # 缩放因子
```

## 输出说明

### C++程序输出（BMP格式）
程序会生成一个BMP格式的图像文件，其中：
- **黑色背景**：图像背景
- **红色轨迹**：第一个摆球的运动轨迹
- **浅蓝色轨迹**：第二个摆球的运动轨迹
- **白色线条**：摆杆的最终位置
- **彩色圆点**：摆球的最终位置

### Python可视化输出
使用matplotlib生成的高质量图像：
- **PNG静态图**：清晰的轨迹可视化
- **GIF动画**：动态展示双摆运动过程
- **可自定义**：颜色、尺寸、时间范围等

## 算法说明

### Verlet积分算法

程序使用Verlet算法来求解双摆的运动方程：

1. **位置更新**：`x(t+dt) = 2*x(t) - x(t-dt) + a(t)*dt²`
2. **速度计算**：`v(t) = [x(t+dt) - x(t-dt)] / (2*dt)`

### 双摆运动方程

双摆系统的拉格朗日方程推导出的角加速度：

- θ₁和θ₂分别是两个摆的角度
- 考虑了两个摆球间的相互作用力
- 包含重力、离心力和科里奥利力的影响

## 混沌行为

双摆系统是经典的混沌系统，对初始条件极其敏感。微小的初始条件变化可能导致完全不同的轨迹，这在生成的图像中可以清楚地观察到。

## 依赖项

### C++部分
- C++11或更高版本编译器
- make工具

### Python部分（自动管理）
- Python 3.9
- matplotlib（可视化库）
- numpy（数值计算库）

*注意：Python依赖会通过`setup_env.sh`脚本自动安装*

## 注意事项

1. **首次运行**：请先执行`make setup`设置Python环境
2. **时间步长**：dt不宜过大，建议0.001-0.01之间
3. **模拟时间**：过长可能导致数值误差累积
4. **图像尺寸**：需要根据摆长调整缩放因子
5. **磁盘空间**：BMP文件和GIF动画可能较大
6. **环境清理**：使用`make clean`可以删除包括Python环境在内的所有文件
